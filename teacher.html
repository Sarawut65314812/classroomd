<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emoji Game Setup</title>
<style>
body { font-family:sans-serif; text-align:center; margin:10px; }
input, button { font-size:16px; margin:5px; padding:5px; text-transform: lowercase; }
textarea {
  font-size:16px; margin:5px; padding:5px; width:250px; height:120px; resize:none;
  border:1px solid #ccc; border-radius:5px;
  background: repeating-linear-gradient(
    to bottom,
    #fff,
    #fff 28px,
    #ccc 28px,
    #ccc 30px
  );
  line-height:30px;
  text-transform: lowercase; /* ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å */
}
button { cursor:pointer; }
.image-preview-item {
  display: inline-block;
  margin: 10px;
  position: relative;
  border: 2px solid #ddd;
  border-radius: 10px;
  overflow: hidden;
  width: 120px;
  height: 120px;
  background: repeating-conic-gradient(#ddd 0% 25%, transparent 0% 50%) 50% / 20px 20px;
}
.image-preview-item img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}
.image-preview-item .remove-btn {
  position: absolute;
  top: 5px;
  right: 5px;
  background: #f44336;
  color: white;
  border: none;
  border-radius: 50%;
  width: 25px;
  height: 25px;
  cursor: pointer;
  font-size: 16px;
  line-height: 1;
}
.file-input-wrapper {
  position: relative;
  display: inline-block;
  margin: 10px;
}
.file-input-wrapper input[type=file] {
  position: absolute;
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.file-input-label {
  display: inline-block;
  padding: 10px 20px;
  background-color: #4CAF50;
  color: white;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
}
.file-input-label:hover {
  background-color: #45a049;
}
.choice-item {
  background: #f0f0f0;
  padding: 8px;
  margin: 5px 0;
  border-radius: 5px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.choice-item button {
  background: #f44336;
  color: white;
  border: none;
  padding: 5px 10px;
  border-radius: 3px;
  cursor: pointer;
  font-size: 12px;
}
</style>
</head>
<body>

<h2>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏°</h2>

<label>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á: <input id="topicInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏±‡∏ï‡∏ß‡πå, ‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡∏ú‡∏•‡πÑ‡∏°‡πâ" style="width:300px;"></label><br><br>

<h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h3>
<div style="display:flex; gap:20px; justify-content:center; margin:20px;">
  <div style="flex:1; max-width:400px;">
    <label style="color:#4CAF50; font-weight:bold;">‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚úÖ</label><br>
    <div class="file-input-wrapper">
      <label class="file-input-label">üì∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
        <input type="file" id="correctImageInput" accept="image/*" onchange="handleImageUpload(event, 'correct')">
      </label>
    </div>
    <div id="correctImagesList" style="margin-top:10px;"></div>
  </div>
  
  <div style="flex:1; max-width:400px;">
    <label style="color:#f44336; font-weight:bold;">‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î ‚ùå</label><br>
    <div class="file-input-wrapper">
      <label class="file-input-label">üì∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
        <input type="file" id="wrongImageInput" accept="image/*" onchange="handleImageUpload(event, 'wrong')">
      </label>
    </div>
    <div id="wrongImagesList" style="margin-top:10px;"></div>
  </div>
</div>

<button onclick="saveConfig()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å & ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏°</button>

<script>
let correctImages = [];
let wrongImages = [];

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
function handleImageUpload(event, type) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const img = new Image();
    img.onload = function() {
      // Auto crop to square
      const croppedImageData = autoCropToSquare(img);
      
      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏¢‡πå
      if (type === 'correct') {
        correctImages.push(croppedImageData);
        event.target.value = ''; // Clear input
        renderImages('correct');
      } else {
        wrongImages.push(croppedImageData);
        event.target.value = ''; // Clear input
        renderImages('wrong');
      }
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
function autoCropToSquare(img) {
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  
  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
  const maxSize = 300;
  let width = img.width;
  let height = img.height;
  
  // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ñ‡πâ‡∏≤‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÇ‡∏î‡∏¢‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô
  if (width > maxSize || height > maxSize) {
    if (width > height) {
      height = (height / width) * maxSize;
      width = maxSize;
    } else {
      width = (width / height) * maxSize;
      height = maxSize;
    }
  }
  
  canvas.width = width;
  canvas.height = height;
  
  // ‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏•‡∏á‡∏ö‡∏ô canvas
  ctx.drawImage(img, 0, 0, width, height);
  
  // ‡∏ï‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
  const imageData = ctx.getImageData(0, 0, width, height);
  const data = imageData.data;
  
  // ‡∏´‡∏≤‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏°‡∏∏‡∏° 4 ‡∏°‡∏∏‡∏°)
  const corners = [
    [0, 0], // ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô
    [width - 1, 0], // ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô
    [0, height - 1], // ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á
    [width - 1, height - 1] // ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á
  ];
  
  let bgColor = null;
  for (let corner of corners) {
    const x = corner[0];
    const y = corner[1];
    const index = (y * width + x) * 4;
    const r = data[index];
    const g = data[index + 1];
    const b = data[index + 2];
    
    if (r > 200 && g > 200 && b > 200) { // ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
      bgColor = { r, g, b };
      break;
    }
  }
  
  // ‡∏ï‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å (‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á)
  if (bgColor) {
    const threshold = 40; // ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡∏µ
    for (let i = 0; i < data.length; i += 4) {
      const r = data[i];
      const g = data[i + 1];
      const b = data[i + 2];
      
      // ‡∏ñ‡πâ‡∏≤‡∏™‡∏µ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á ‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™
      if (Math.abs(r - bgColor.r) < threshold && 
          Math.abs(g - bgColor.g) < threshold && 
          Math.abs(b - bgColor.b) < threshold) {
        data[i + 3] = 0; // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™
      }
    }
    
    ctx.putImageData(imageData, 0, 0);
  }
  
  // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô base64 (‡πÉ‡∏ä‡πâ PNG ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™)
  return canvas.toDataURL('image/png', 0.9);
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
function removeImage(type, index) {
  if (type === 'correct') {
    correctImages.splice(index, 1);
    renderImages('correct');
  } else {
    wrongImages.splice(index, 1);
    renderImages('wrong');
  }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
function renderImages(type) {
  const listId = type === 'correct' ? 'correctImagesList' : 'wrongImagesList';
  const images = type === 'correct' ? correctImages : wrongImages;
  const list = document.getElementById(listId);
  
  list.innerHTML = images.map((imgData, i) => `
    <div class="image-preview-item">
      <img src="${imgData}" alt="Image ${i+1}">
      <button class="remove-btn" onclick="removeImage('${type}', ${i})">√ó</button>
    </div>
  `).join('');
}

// ‡πÇ‡∏´‡∏•‡∏î config ‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
const savedConfig = JSON.parse(localStorage.getItem('emojiGameConfig')||'{}');
if(savedConfig.topic) document.getElementById('topicInput').value = savedConfig.topic;
if(savedConfig.correctImages) correctImages = savedConfig.correctImages;
if(savedConfig.wrongImages) wrongImages = savedConfig.wrongImages;
renderImages('correct');
renderImages('wrong');

function saveConfig(){
  const topic = document.getElementById('topicInput').value.trim();

  if(!topic){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á"); return; }
  if(correctImages.length === 0){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏π‡∏õ"); return; }
  if(wrongImages.length === 0){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏π‡∏õ"); return; }

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å config ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  const config = {
    topic: topic,
    correctImages: correctImages,
    wrongImages: wrongImages
  };
  localStorage.setItem('emojiGameConfig', JSON.stringify(config));

  // ‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏°
  window.location.href='game.html';
}
</script>

</body>
</html>
